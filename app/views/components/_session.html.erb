<div class="bg-gray-100 rounded-lg p-3 shadow-md border">
  <div class="flex items-center justify-between">
    <button id="toggle-button-<%= session_id %>" class="flex items-center text-left py-2 gap-1"
          onclick="toggleSession('<%= session_id %>')">
        <i id="icon-<%= session_id %>" class="fa-solid fa-angle-right md:hidden"></i>
        <span class="font-bold text-lg"><%= start_end %></span>
    </button>
    <span class="hidden sm:inline font-bold text-lg"><%= start_end %></span>
    <% if location.present? %>
      <%= render 'components/badge', label: location %>
    <% end %>
  </div>
  <%# セッションリスト (最初の1つはデフォルト表示) %>
  <div id="<%= session_id %>" class="mt-2 flex flex-wrap flex-row gap-4">
    <% sessions.each_with_index do |session, index| %>
      <div class="session-item <%= index > 0 ? 'hidden' : '' %>">
        <%= render 'components/session_card', schedule: session, attendees: attendees, scheduled: scheduled %>
      </div>
    <% end %>
  </div>
</div>
<script>
  function toggleSession(sessionId) {
    const sessionElement = document.getElementById(sessionId);
    const iconElement = document.getElementById(`icon-${sessionId}`);
    const sessionItems = sessionElement.querySelectorAll(".session-item");

    if (sessionElement) {
      const isExpanded = sessionItems.length > 1 && !sessionItems[1].classList.contains("hidden");

      // 最初の1件以外をトグル
      sessionItems.forEach((el, index) => {
        if (index > 0) {
          el.classList.toggle("hidden", isExpanded);
        }
      });

      // アイコンの向きを変更
      iconElement.classList.toggle("fa-angle-right", isExpanded);
      iconElement.classList.toggle("fa-angle-down", !isExpanded);
    }
  }

  // 画面に応じた処理
  function handleResize() {
    const toggleButtons = document.querySelectorAll('[id^="toggle-button-"]');
    toggleButtons.forEach(button => {
      if (window.innerWidth >= 640) {
        button.classList.add('hidden');
      } else {
        button.classList.remove('hidden');
      }
    });

    const sessionItems = document.querySelectorAll('.session-item');
    if (window.innerWidth >= 640) {
      sessionItems.forEach(item => {
        item.classList.remove('hidden');
      });
    }
  }

  window.addEventListener('resize', handleResize);
  document.addEventListener('DOMContentLoaded', handleResize);
</script>
